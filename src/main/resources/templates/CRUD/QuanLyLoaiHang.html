<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{CRUD/shared/layout :: layout(~{::title}, ~{::div})}"> <!-- Sửa lại đây -->
<head>
  <title>Quản lý loại sản phẩm</title>
</head>
<body>
<div th:fragment="content"> <!-- Thay content bằng div và thêm th:fragment="content" -->
  <div class="container my-4">
    <h3 class="mb-4 text-center">Quản lý loại sản phẩm</h3>

    <!-- Hiển thị thông báo flash message -->
    <div th:if="${message}" th:classappend="${messageType == 'success' ? 'alert-success' : 'alert-danger'}" class="alert alert-dismissible fade show" role="alert">
      <span th:text="${message}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div class="d-flex justify-content-end mb-3">
      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addEditModal"
              data-mode="add">
        + Thêm loại sản phẩm
      </button>
    </div>

    <table class="table table-bordered table-hover text-center align-middle">
      <thead class="table-dark">
      <tr>
        <th>STT</th>
        <th>Mã loại</th>
        <th>Tên loại</th>
        <th>Hành động</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="lsp, stat : ${listLoaiSanPham}">
        <td th:text="${stat.index + 1}"></td>
        <td th:text="${lsp.maLoai}"></td>
        <td th:text="${lsp.tenLoai}"></td>
        <td>
          <button class="btn btn-warning btn-sm"
                  data-bs-toggle="modal"
                  data-bs-target="#addEditModal"
                  data-mode="edit"
                  th:data-ma-loai="${lsp.maLoai}"
                  th:data-ten-loai="${lsp.tenLoai}">
            Sửa
          </button>
          <button class="btn btn-danger btn-sm"
                  data-bs-toggle="modal"
                  data-bs-target="#deleteModal"
                  th:data-ma-loai="${lsp.maLoai}">
            Xóa
          </button>
        </td>
      </tr>
      <tr th:if="${listLoaiSanPham.isEmpty()}">
        <td colspan="4">Không có loại sản phẩm nào.</td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal Thêm/Sửa (sử dụng chung) -->
  <div class="modal fade" id="addEditModal" tabindex="-1" aria-labelledby="addEditModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="loaiSanPhamForm" th:action="@{/crud/loai-san-pham/save}" method="post">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title" id="addEditModalLabel"></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <div class="mb-3">
              <label for="maLoai" class="form-label">Mã loại</label>
              <input type="text" class="form-control" id="maLoai" name="maLoai" readonly>
              <small class="form-text text-muted">Mã loại sẽ tự động tạo khi thêm mới.</small>
            </div>
            <div class="mb-3">
              <label for="tenLoai" class="form-label">Tên loại</label>
              <input type="text" class="form-control" id="tenLoai" name="tenLoai" required>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
            <button type="submit" class="btn btn-success">Lưu</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal Xóa -->
  <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title" id="deleteModalLabel">Xác nhận xóa</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Bạn có chắc chắn muốn xóa loại sản phẩm này không?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
          <a id="deleteConfirmButton" href="#" class="btn btn-danger">Xóa</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Script cho Bootstrap Modals và JavaScript xử lý logic -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var addEditModal = document.getElementById('addEditModal');
      var deleteModal = document.getElementById('deleteModal');

      // Lắng nghe sự kiện khi modal Thêm/Sửa được hiển thị
      addEditModal.addEventListener('show.bs.modal', function(event) {
        var button = event.relatedTarget; // Nút đã kích hoạt modal

        var mode = button.getAttribute('data-mode'); // "add" hoặc "edit"
        var maLoai = button.getAttribute('data-ma-loai');
        var tenLoai = button.getAttribute('data-ten-loai');

        var modalTitle = addEditModal.querySelector('.modal-title');
        var inputMaLoai = addEditModal.querySelector('#maLoai');
        var inputTenLoai = addEditModal.querySelector('#tenLoai');

        if (mode === 'edit') {
          modalTitle.textContent = 'Chỉnh sửa loại sản phẩm';
          inputMaLoai.value = maLoai;
          inputTenLoai.value = tenLoai;
        } else { // mode === 'add'
          modalTitle.textContent = 'Thêm loại sản phẩm';
          inputMaLoai.value = '';
          inputTenLoai.value = '';
        }
      });

      // Lắng nghe sự kiện khi modal Xóa được hiển thị
      deleteModal.addEventListener('show.bs.modal', function(event) {
        var button = event.relatedTarget; // Nút đã kích hoạt modal
        var maLoai = button.getAttribute('data-ma-loai');

        var deleteConfirmButton = deleteModal.querySelector('#deleteConfirmButton');
        deleteConfirmButton.href = '/crud/loai-san-pham/delete/' + (maLoai ? maLoai : '');
      });

      // Đóng alert sau 5 giây (tùy chọn)
      setTimeout(function() {
        var alertElement = document.querySelector('.alert');
        if (alertElement) {
          var bootstrapAlert = bootstrap.Alert.getInstance(alertElement);
          if (!bootstrapAlert) {
            bootstrapAlert = new bootstrap.Alert(alertElement);
          }
          bootstrapAlert.close();
        }
      }, 5000); // 5 giây
    });
  </script>
</div> <!-- Đóng thẻ div cho th:fragment="content" -->
</body>
</html>//