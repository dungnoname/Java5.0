<html th:replace="~{/shared/layout :: layout(~{::title}, ~{::content})}" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Qu·∫£n l√Ω ƒë∆°n h√†ng</title>
</head>

<body>
<content>
    <div class="container py-4">
        <h3 class="mb-4">üì¶ Qu·∫£n l√Ω ƒë∆°n h√†ng</h3>

        <!-- Tabs -->
        <ul class="nav nav-tabs mb-3" id="orderTabs" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" id="checkout-tab" data-bs-toggle="tab" data-bs-target="#checkout">ƒê·∫∑t h√†ng</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="orders-tab" data-bs-toggle="tab" data-bs-target="#orders">ƒê∆°n h√†ng c·ªßa t√¥i</button>
            </li>
        </ul>

        <div class="tab-content">
            <!-- TAB 1: ƒê·∫∂T H√ÄNG -->
            <div class="tab-pane fade show active" id="checkout">
                <div class="row">
                    <div class="col-lg-6">
                        <h5>Th√¥ng tin kh√°ch h√†ng</h5>
                        <form th:action="@{/don-hang/xac-nhan}" method="post">
                            <div class="mb-3">
                                <label class="form-label">H·ªç t√™n</label>
                                <input type="text" class="form-control"
                                       th:value="${session.userSession != null ? session.userSession.hoTen : 'Kh√°ch h√†ng t·∫°m th·ªùi'}"
                                       readonly>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
                                <input type="text" class="form-control"
                                       th:value="${session.userSession != null ? session.userSession.soDienThoai : 'Ch∆∞a c√≥ s·ªë ƒëi·ªán tho·∫°i'}"
                                       readonly>


                            </div>
                            <div class="mb-3">
                                <label class="form-label">ƒê·ªãa ch·ªâ giao h√†ng</label>
                                <textarea class="form-control" rows="3" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ giao h√†ng"></textarea>
                            </div>
                            <button type="submit" class="btn btn-success">X√°c nh·∫≠n ƒë·∫∑t h√†ng</button>
                        </form>
                    </div>

                    <div class="col-lg-6">
                        <h5>S·∫£n ph·∫©m trong gi·ªè</h5>
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between align-items-center"
                                th:each="item : ${gioHangList}">
                            <span>
                                <strong th:text="${item.sanPham.tenSP}"></strong>
                                (<span th:text="${item.soLuong}"></span>x)

                            </span>
                                <span class="fw-bold" th:text="${#numbers.formatDecimal(item.sanPham.donGiaBan, 0, 'COMMA', 0, 'POINT')} + ' ƒë'"></span>
                            </li>
                        </ul>
                        <div class="mt-3 text-end">
                            <h5>T·ªïng: <span class="text-danger" th:text="${#numbers.formatDecimal(tongTien, 0, 'COMMA', 0, 'POINT')} + ' ƒë'"></span></h5>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB 2: ƒê∆†N H√ÄNG C·ª¶A T√îI -->
            <div class="tab-pane fade" id="orders">
                <h5>ƒê∆°n h√†ng c·ªßa t√¥i</h5>

                <div th:if="${hoaDonList == null or #lists.isEmpty(hoaDonList)}">

                <p class="text-muted mt-3">B·∫°n ch∆∞a c√≥ ƒë∆°n h√†ng n√†o.</p>
                </div>

                <table class="table table-bordered table-hover mt-3" th:if="${hoaDonList != null and !#lists.isEmpty(hoaDonList)}">

                <thead class="table-light">
                    <tr>
                        <th>M√£ ƒë∆°n</th>
                        <th>Ng√†y ƒë·∫∑t</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th>Xem chi ti·∫øt</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="hd : ${hoaDonList}">
                        <td th:text="'#HD' + ${hd.maHD}"></td>
                        <td th:text="${#temporals.format(hd.ngayLap, 'dd/MM/yyyy HH:mm')}"></td>
                        <td>
                        <span class="badge"
                                      th:classappend="${hd.trangThaiDonHang.tenTT == 'Ch·ªù x√°c nh·∫≠n'} ? 'bg-warning text-dark' :
                              (hd.trangThaiDonHang.tenTT == 'ƒê√£ x√°c nh·∫≠n' ? 'bg-info' :
                              (hd.trangThaiDonHang.tenTT == 'ƒêang giao' ? 'bg-primary' :
                              (hd.trangThaiDonHang.tenTT == 'Ho√†n th√†nh' ? 'bg-success' : 'bg-danger')))"
                                      th:text="${hd.trangThaiDonHang.tenTT}">
                        </span>
                        </td>
                        <td>
                            <a th:href="@{'/don-hang/chi-tiet/' + ${hd.maHD}}" class="btn btn-outline-primary btn-sm">Chi ti·∫øt</a>
                            <form th:action="@{'/don-hang/huy/' + ${hd.maHD}}" method="post" th:if="${hd.trangThaiDonHang.maTT == 0}" style="display:inline">
                                <button type="submit" class="btn btn-outline-danger btn-sm"
                                        onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy ƒë∆°n h√†ng n√†y?')">H·ªßy</button>
                            </form>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</content>
</body>
</html>
